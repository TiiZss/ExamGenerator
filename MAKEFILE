# ExamGenerator - Makefile para instalaciÃ³n y gestiÃ³n
# by TiiZss

.PHONY: install install-dev test clean help setup-linux setup-windows

# Variables
PYTHON := python3
PIP := pip
VENV := .venv
VENV_BIN := $(VENV)/bin

# InstalaciÃ³n principal
install: setup-venv install-deps
    @echo "âœ… InstalaciÃ³n completada"
    @echo "Para activar: source $(VENV_BIN)/activate"

# ConfiguraciÃ³n para Linux
setup-linux:
    @echo "ğŸ§ Configurando para Linux..."
    @chmod +x install.sh quick_install.sh
    @./install.sh

# ConfiguraciÃ³n para Windows (WSL)
setup-windows:
    @echo "ğŸªŸ Para Windows usa: powershell -ExecutionPolicy Bypass -File install.ps1"

# Crear entorno virtual
setup-venv:
    @echo "ğŸ“¦ Creando entorno virtual..."
    @$(PYTHON) -m venv $(VENV)

# Instalar dependencias
install-deps: setup-venv
    @echo "ğŸ“š Instalando dependencias..."
    @$(VENV_BIN)/$(PIP) install --upgrade pip
    @$(VENV_BIN)/$(PIP) install -r requirements.txt

# InstalaciÃ³n para desarrollo (con dependencias adicionales)
install-dev: setup-venv
    @echo "ğŸ”§ InstalaciÃ³n para desarrollo..."
    @$(VENV_BIN)/$(PIP) install --upgrade pip
    @$(VENV_BIN)/$(PIP) install -r requirements.txt
    @$(VENV_BIN)/$(PIP) install pytest black flake8 mypy

# Ejecutar tests bÃ¡sicos
test:
    @echo "ğŸ§ª Ejecutando tests..."
    @$(VENV_BIN)/$(PYTHON) -c "import docx, openpyxl; print('âœ… MÃ³dulos principales OK')"
    @if [ -f eg.py ]; then echo "âœ… eg.py encontrado"; else echo "âŒ eg.py no encontrado"; fi
    @if [ -f qg.py ]; then echo "âœ… qg.py encontrado"; else echo "âŒ qg.py no encontrado"; fi

# Ejecutar ejemplo bÃ¡sico
example:
    @echo "ğŸ¯ Ejecutando ejemplo..."
    @$(VENV_BIN)/$(PYTHON) eg.py preguntas.txt Ejemplo 2 5

# Limpiar archivos generados
clean:
    @echo "ğŸ§¹ Limpiando..."
    @rm -rf $(VENV)
    @rm -rf Examenes_*
    @rm -rf __pycache__
    @rm -rf *.pyc
    @echo "âœ… Limpieza completada"

# Mostrar ayuda
help:
    @echo "ExamGenerator - Comandos disponibles:"
    @echo ""
    @echo "  make install      - InstalaciÃ³n completa"
    @echo "  make setup-linux  - InstalaciÃ³n con script para Linux"
    @echo "  make install-dev  - InstalaciÃ³n para desarrollo"
    @echo "  make test         - Verificar instalaciÃ³n"
    @echo "  make example      - Ejecutar ejemplo bÃ¡sico"
    @echo "  make clean        - Limpiar archivos generados"
    @echo "  make help         - Mostrar esta ayuda"
    @echo ""
    @echo "Para Windows: make setup-windows"

# Regla por defecto
all: install