# ExamGenerator - Makefile para instalaci√≥n y gesti√≥n
# by TiiZss

.PHONY: install install-dev test clean help setup-linux setup-windows

# Variables
PYTHON := python3
PIP := pip
VENV := .venv
VENV_BIN := $(VENV)/bin

# Instalaci√≥n principal
install: setup-venv install-deps
    @echo "‚úÖ Instalaci√≥n completada"
    @echo "Para activar: source $(VENV_BIN)/activate"

# Configuraci√≥n para Linux
setup-linux:
    @echo "üêß Configurando para Linux..."
    @chmod +x install.sh quick_install.sh
    @./install.sh

# Configuraci√≥n para Windows (WSL)
setup-windows:
    @echo "ü™ü Para Windows usa: powershell -ExecutionPolicy Bypass -File install.ps1"

# Crear entorno virtual
setup-venv:
    @echo "üì¶ Creando entorno virtual..."
    @$(PYTHON) -m venv $(VENV)

# Instalar dependencias
install-deps: setup-venv
    @echo "üìö Instalando dependencias..."
    @$(VENV_BIN)/$(PIP) install --upgrade pip
    @$(VENV_BIN)/$(PIP) install -r requirements.txt

# Instalaci√≥n para desarrollo (con dependencias adicionales)
install-dev: setup-venv
    @echo "üîß Instalaci√≥n para desarrollo..."
    @$(VENV_BIN)/$(PIP) install --upgrade pip
    @$(VENV_BIN)/$(PIP) install -r requirements.txt
    @$(VENV_BIN)/$(PIP) install pytest black flake8 mypy

# Ejecutar tests b√°sicos
test:
    @echo "üß™ Ejecutando tests..."
    @$(VENV_BIN)/$(PYTHON) -c "import docx, openpyxl; print('‚úÖ M√≥dulos principales OK')"
    @if [ -f eg.py ]; then echo "‚úÖ eg.py encontrado"; else echo "‚ùå eg.py no encontrado"; fi
    @if [ -f qg.py ]; then echo "‚úÖ qg.py encontrado"; else echo "‚ùå qg.py no encontrado"; fi

# Ejecutar ejemplo b√°sico
example:
    @echo "üéØ Ejecutando ejemplo..."
    @$(VENV_BIN)/$(PYTHON) eg.py preguntas.txt Ejemplo 2 5

# Limpiar archivos generados
clean:
    @echo "üßπ Limpiando..."
    @rm -rf $(VENV)
    @rm -rf Examenes_*
    @rm -rf __pycache__
    @rm -rf *.pyc
    @echo "‚úÖ Limpieza completada"

# Mostrar ayuda
help:
    @echo "ExamGenerator - Comandos disponibles:"
    @echo ""
    @echo "  make install      - Instalaci√≥n completa"
    @echo "  make setup-linux  - Instalaci√≥n con script para Linux"
    @echo "  make install-dev  - Instalaci√≥n para desarrollo"
    @echo "  make test         - Verificar instalaci√≥n"
    @echo "  make example      - Ejecutar ejemplo b√°sico"
    @echo "  make clean        - Limpiar archivos generados"
    @echo "  make help         - Mostrar esta ayuda"
    @echo ""
    @echo "Para Windows: make setup-windows"

# Regla por defecto
all: install